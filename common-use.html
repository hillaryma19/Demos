<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div style="height: 2000px; border: 1px solid #000;"></div>
    <script>
        // 防抖
        function debounce(func, ms = 1000){
            let timer;
            return function(...args){
                if (timer) {
                    clearTimeout(timer)
                }
                timer = setTimeout(() => {
                    func.apply(this, args)
                }, ms)
            }
        }
        // 防抖测试
        const taskTest1 = () => {
            console.log('run task test debounce');
        }
        const debounceTask = debounce(taskTest1, 1000);
        window.addEventListener('scroll', debounceTask);

        // 节流
        function throttle(func, ms = 1000){
            let canRun = true;
            return function(...args){
                if (!canRun) {
                    return
                }
                canRun = false
                setTimeout(() => {
                    func.apply(this, args)
                    canRun = true
                }, ms)
            }
        }
        // 节流测试
        const taskTest2 = () => {
            console.log('run task test throttle');
        }
        const throttleTask = throttle(taskTest2, 1000);
        window.addEventListener('scroll', throttleTask);

        // new
        function myNew(Func, ...args){
            const instance = {};
            if (Func.prototype) {
                Object.setPrototypeOf(instance, Func.prototype)
            }
            const ress = Func.apply(instance, args);
            if (typeof res === 'function' || (typeof res === 'object' && res !==  null)) {
                return res;
            }
            return instance
        }
        // new 测试
        function Person(name){
            this.name = name;
        }
        Person.prototype.sayName = function(){
            console.log(`My name is ${this.name}`);
        }
        const me = myNew(Person, 'Jack');
        me.sayName();
        console.log(me);

        // bind
        Function.prototype.myBind = function(context = globalThis){
            const fn = this;
            const args = Array.from(arguments).slice(1);
            const newFunc = function(){
                const newArgs = args.concat(...arguments);
                if (this instanceof newFunc) {
                    // 通过new调用，绑定this为实例对象
                    fn.apply(this, newArgs)
                } else {
                    //通过普通函数形式调用，绑定context
                    fn.apply(context, newArgs)
                }
            }
            // 支持new调用方式
            newFunc.prototype = Object.create(fn.prototype)
            return newFunc
        }
        // bind测试
        const bindMe = {name: 'Jack22'};
        const other = { name: 'Jackson' };
        function say(){
            console.log(`My name is ${this.name || 'default'}`);
        }
        const meSay = say.myBind(bindMe)
        meSay();
        const otherSay = say.myBind(other);
        otherSay()
    </script>
</body>
</html>